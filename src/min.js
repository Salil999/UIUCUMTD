function locationSuccess(e){lat=e.coords.latitude,lon=e.coords.longitude}function locationError(e){console.log("location error ("+e.code+"): "+e.message)}var UI=require("ui"),ajax=require("ajax"),arrayLength,stopIDs=[],stopsNearYou=new UI.Menu({}),stopTimings=new UI.Menu({}),noBus,timeOfBuses={title:"test",items:[{title:"",subtitle:""},{title:"",subtitle:""}]},menuList={title:"Bus Stops Near You",items:[{title:""},{title:""},{title:""},{title:""},{title:""},{title:""}]},main=new UI.Card({title:" UIUCUMTD",icon:"images/bus.png",body:"Welcome to the UIUC bus app!\n\nShashank Saxena",scrollable:!1}),emptyArrayCard=new UI.Card({title:"     No Buses",subtitle:"\n    No buses within 30 mins",scrollable:!1});main.show(),navigator.geolocation.getCurrentPosition(locationSuccess,locationError,{enableHighAccuracy:!0,maximumAge:1e4,timeout:1e4}),main.on("click","select",function(){for(var e=0;6>e;e++)menuList.items[e].title="Loading";stopsNearYou.section(0,menuList),stopsNearYou.show(),navigator.geolocation.getCurrentPosition(locationSuccess,locationError,{enableHighAccuracy:!0,maximumAge:1e4,timeout:1e4}),navigator.geolocation.getCurrentPosition(locationSuccess,locationError,{enableHighAccuracy:!0,maximumAge:1e4,timeout:1e4});var t="https://developer.cumtd.com/api/v2.2/json/GetStopsByLatLon?key=79279d634cac41da9258b1875237c75a&lat="+lat+"&lon="+lon+"&count=6";stopIDs&&(stopIDs=[]),ajax({url:t,type:"json",method:"get",async:!0},function(e){if(e){e=JSON.parse(JSON.stringify(e));for(var t=0;6>t;t++)stopIDs.push(e.stops[t].stop_id),menuList.items[t].title=e.stops[t].stop_name;stopIDs=stopIDs.splice(""),stopIDs=stopIDs.slice(0,6),stopsNearYou.section(0,menuList),stopsNearYou.show()}},function(e){console.log("ERROR - main.on - "+e)}),stopsNearYou.on("select",function(e){noBus===!1&&(timeOfBuses={title:"Loading",items:[{title:"Loading",subtitle:"Fetching Data..."}]},stopTimings.section(0,timeOfBuses),stopTimings.show()),ajax({url:"https://developer.cumtd.com/api/v2.2/json/GetDeparturesByStop?key=79279d634cac41da9258b1875237c75a&stop_id="+stopIDs[e.itemIndex],type:"json",method:"get",async:!0},function(t){if(t)switch(t=JSON.parse(JSON.stringify(t)),arrayLength=t.departures.length,timeOfBuses.title=e.item.title,arrayLength){case 0:emptyArrayCard.show(),noBus=!0;break;case 1:timeOfBuses={title:e.item.title,items:[{title:t.departures[0].headsign,subtitle:t.departures[0].expected_mins+" Minute(s)"}]};break;case 2:timeOfBuses={title:e.item.title,items:[{title:t.departures[0].headsign,subtitle:t.departures[0].expected_mins+" Minute(s)"},{title:t.departures[1].headsign,subtitle:t.departures[1].expected_mins+" Minute(s)"}]};break;case 3:timeOfBuses={title:e.item.title,items:[{title:t.departures[0].headsign,subtitle:t.departures[0].expected_mins+" Minute(s)"},{title:t.departures[1].headsign,subtitle:t.departures[1].expected_mins+" Minute(s)"},{title:t.departures[2].headsign,subtitle:t.departures[2].expected_mins+" Minute(s)"}]};break;case 4:timeOfBuses={title:e.item.title,items:[{title:t.departures[0].headsign,subtitle:t.departures[0].expected_mins+" Minute(s)"},{title:t.departures[1].headsign,subtitle:t.departures[1].expected_mins+" Minute(s)"},{title:t.departures[2].headsign,subtitle:t.departures[2].expected_mins+" Minute(s)"},{title:t.departures[3].headsign,subtitle:t.departures[3].expected_mins+" Minute(s)"}]};break;case 5:timeOfBuses={title:e.item.title,items:[{title:t.departures[0].headsign,subtitle:t.departures[0].expected_mins+" Minute(s)"},{title:t.departures[1].headsign,subtitle:t.departures[1].expected_mins+" Minute(s)"},{title:t.departures[2].headsign,subtitle:t.departures[2].expected_mins+" Minute(s)"},{title:t.departures[3].headsign,subtitle:t.departures[3].expected_mins+" Minute(s)"},{title:t.departures[4].headsign,subtitle:t.departures[4].expected_mins+" Minute(s)"}]};break;case 6:timeOfBuses={title:e.item.title,items:[{title:t.departures[0].headsign,subtitle:t.departures[0].expected_mins+" Minute(s)"},{title:t.departures[1].headsign,subtitle:t.departures[1].expected_mins+" Minute(s)"},{title:t.departures[2].headsign,subtitle:t.departures[2].expected_mins+" Minute(s)"},{title:t.departures[3].headsign,subtitle:t.departures[3].expected_mins+" Minute(s)"},{title:t.departures[4].headsign,subtitle:t.departures[4].expected_mins+" Minute(s)"},{title:t.departures[5].headsign,subtitle:t.departures[5].expected_mins+" Minute(s)"}]};break;case 7:timeOfBuses={title:e.item.title,items:[{title:t.departures[0].headsign,subtitle:t.departures[0].expected_mins+" Minute(s)"},{title:t.departures[1].headsign,subtitle:t.departures[1].expected_mins+" Minute(s)"},{title:t.departures[2].headsign,subtitle:t.departures[2].expected_mins+" Minute(s)"},{title:t.departures[3].headsign,subtitle:t.departures[3].expected_mins+" Minute(s)"},{title:t.departures[4].headsign,subtitle:t.departures[4].expected_mins+" Minute(s)"},{title:t.departures[5].headsign,subtitle:t.departures[5].expected_mins+" Minute(s)"},{title:t.departures[6].headsign,subtitle:t.departures[6].expected_mins+" Minute(s)"}]};break;case 8:timeOfBuses={title:e.item.title,items:[{title:t.departures[0].headsign,subtitle:t.departures[0].expected_mins+" Minute(s)"},{title:t.departures[1].headsign,subtitle:t.departures[1].expected_mins+" Minute(s)"},{title:t.departures[2].headsign,subtitle:t.departures[2].expected_mins+" Minute(s)"},{title:t.departures[3].headsign,subtitle:t.departures[3].expected_mins+" Minute(s)"},{title:t.departures[4].headsign,subtitle:t.departures[4].expected_mins+" Minute(s)"},{title:t.departures[5].headsign,subtitle:t.departures[5].expected_mins+" Minute(s)"},{title:t.departures[6].headsign,subtitle:t.departures[6].expected_mins+" Minute(s)"},{title:t.departures[7].headsign,subtitle:t.departures[7].expected_mins+" Minute(s)"}]};break;default:timeOfBuses={title:e.item.title,items:[{title:t.departures[0].headsign,subtitle:t.departures[0].expected_mins+" Minute(s)"},{title:t.departures[1].headsign,subtitle:t.departures[1].expected_mins+" Minute(s)"},{title:t.departures[2].headsign,subtitle:t.departures[2].expected_mins+" Minute(s)"},{title:t.departures[3].headsign,subtitle:t.departures[3].expected_mins+" Minute(s)"},{title:t.departures[4].headsign,subtitle:t.departures[4].expected_mins+" Minute(s)"},{title:t.departures[5].headsign,subtitle:t.departures[5].expected_mins+" Minute(s)"},{title:t.departures[6].headsign,subtitle:t.departures[6].expected_mins+" Minute(s)"},{title:t.departures[7].headsign,subtitle:t.departures[7].expected_mins+" Minute(s)"}]}}arrayLength>0&&(timeOfBuses=JSON.parse(JSON.stringify(timeOfBuses)),stopTimings.section(0,timeOfBuses),stopTimings.show(),timeOfBuses={title:"test",items:[{title:"",subtitle:""},{title:"",subtitle:""}]})},function(e){console.log("ERROR - stopsNearYou.on - "+e)})})});